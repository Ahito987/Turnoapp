<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TurnosApp</title>
  <link rel="manifest" href="manifest.json"/>
  <meta name="theme-color" content="#2f4e37" />
  <link rel="icon" href="assets/icono-app38x46.png" type="image/png">

<style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: Arial, sans-serif;
      background-color: #171817;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }
    header, footer {
      text-align: center;
      background-color: #567964;
      color: white;
      padding: 10px;
    }
    .menu-toggle {
      font-size: 24px;
      cursor: pointer;
      margin-right: 10px;
      vertical-align: middle;
      display: inline-block;
    }
    .logo {
      width: 38px;
      vertical-align: middle;
    }
    nav {
      position: fixed;
      top: 0;
      left: -250px;
      width: 200px;
      height: 100%;
      background-color: #3d5a40;
      transition: left 0.3s ease;
      padding-top: 60px;
      z-index: 10;
    }
    nav a {
      display: block;
      color: white;
      padding: 10px 20px;
      text-decoration: none;
    }
    nav a:hover {
      background-color: #5a7b5f;
    }
    nav.open {
      left: 0;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      padding: 15px;
      background-color: #d8e9dc;
      align-items: center;
      font-weight: bold;
      font-size: 1rem;
    }
    .controls button {
      background-color: #2f4e37;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 5px;
      font-size: 1.2rem;
      width: 350px;
    }
    #mesActual {
      font-size: 1.6rem;
      font-weight: bold;
    }
    #diasSemana {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      background-color: #f38f0d;
      text-align: center;
      font-weight: bold;
      padding: 5px 0;
    }
    #calendario {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.5px;
      background-color:#567964;
      padding: 10px;
      min-height: 50vh;/*100vh*/
    }
    .dia {
      background-color: white;
      padding: 2px;
      min-height: 60px;
      cursor: pointer;
      font-size: 0.9em;
      font-weight: bold;
      text-align: center;
    }

    table { 
      width: 100%;
       border-collapse: collapse;
        margin-top: 1rem;
       }
      
       th, td {
         border: 1px solid #6e6c6c;
          padding: 0.5rem;
           text-align: left; 

    }
    #calendarioMes {
       display: grid;
        grid-template-columns: repeat(7, 1fr);
         gap: 0.25rem; 
         margin-top: 1rem; }

    .modal {
      display: flex;
      align-items: center;
      justify-content: center;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
    }
    .modal.hidden {
      display: none;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 5px;
      width: 300px;
    }
    .cerrar {
      float: right;
      cursor: pointer;
      font-size: 20px;
    }
    footer img {
      vertical-align: middle;
    }
    @media (max-width: 600px) {
      .controls {
        flex-direction: column;
        align-items: center;
        gap: 10px;
        text-align: center;
      }
      .controls button {
        width: 100%;
        max-width: 250px;
      }
      #mesActual {
        font-size: 1.5rem;
        margin-bottom: 5px;
      }
    
    @media (max-width: 600px) {
  .dia {
    font-size: 0.8em;
    min-height: 50px;
    padding: 1px;
  }

    .tabla-responsive {
  width: 100%;
  overflow-x: auto;
}
   .tabla-responsive table {
  width: 100%;
  min-width: 500px; /* o m√°s, seg√∫n el contenido */
  border-collapse: collapse;
}
@media (max-width: 600px) {
  th, td {
    font-size: 14px;
    padding: 6px;
  }
    #seccionCalendario {
      display: block;
    }

    #seccionTurnos {
      display: none;
      padding: 20px;
      background: #fff;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 8px;
      text-align: left;
      border: 1px solid #ccc;
    }
  
   #tablaTurnos td:first-child,
  #tablaTurnos th:first-child {
  width: 40px; /* Ajusta seg√∫n el tama√±o deseado */
  white-space: nowrap; /* Evita salto de l√≠nea */
}

  </style>
</head>
<body>
  <header>
    <span class="menu-toggle" onclick="toggleMenu()">&#9776;</span>
    <img src="assets/icono-app38x46.png" alt="logo" class="logo"/>
    <h1 style="display:inline">TurnosApp</h1>
  </header>

  <nav id="sideMenu">
    <a href="#" data-section="turnos">Turnos Generados</a>
    <a href="#" data-section="festivos">A√±adir Festivos</a>
    <a href="#" data-section="calendario">Calendario</a>
  </nav>

  <div class="controls">
    <button id="btnPrev">¬´ Anterior</button>
    <span id="tituloMes"></span>
    <button id="btnNext">Siguiente ¬ª</button>
  </div>

  <!-- CALENDARIO -->
  <div id="seccionCalendario">
    <div id="diasSemana">
      <div>Lun</div><div>Mar</div><div>Mi√©</div><div>Jue</div><div>Vie</div><div>S√°b</div><div>Dom</div>
    </div>
    <div id="calendario"></div>
  </div>

  <!-- MODAL TURNO -->
  <div id="modalTurno" class="modal hidden">
    <div class="modal-content">
      <span id="cerrarModal" class="cerrar">&times;</span>
      <h2>Apunta tu Turno</h2>
      <form id="formEditarTurno">
        <label for="editFecha">Fecha:</label>
        <input type="date" id="editFecha" readonly />
        <label for="editHora">Hora:</label>
        <input type="time" id="editHora" required />
        <label for="editTipo">Tipo de Turno:</label>
        <select id="editTipo" required>
          <option value="M">Ma√±ana</option>
          <option value="T">Tarde</option>
          <option value="N">Noche</option>
          <option value="V">Vacaciones</option>
          <option value="L">Libranza</option>
          <option value="BH">D√©bito Horario</option>
          <option value="AP">Asunto Propio</option>
          <option value="DC">D√≠a Conciliaci√≥n</option>
          <option value="PE">Permiso Especial</option>
          <option value="EX">Permiso Ex√°men</option>
        </select>
        <label for="editNota">Notas:</label>
        <textarea id="editNota" rows="2"></textarea>
        <button type="submit">üíæ Guardar Cambios</button>
      </form>
    </div>
  </div>

  <!-- SECCI√ìN TURNOS -->
  <div id="seccionTurnos">
    <div class="tabla-responsive">
    <h2>Turnos Generados</h2>
    <table id="tablaTurnos">
      <thead>
        <tr><th>Fecha</th><th>Hora</th><th>Tipo</th><th>Nota</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  </div>

  <!-- SECCI√ìN FESTIVOS -->
  <div id="seccionFestivos" style="display:none; padding: 20px; background:#fff;">
    <h2>A√±adir Festivo</h2>
    <form id="formFestivo">
      <label for="fechaFestivo">Fecha:</label>
      <input type="date" id="fechaFestivo" required />
      <label for="notaFestivo">Notas:</label>
      <input type="text" id="notaFestivo" placeholder="Ej: D√≠a de la Constituci√≥n" />
      <button type="submit">A√±adir Festivo</button>
    </form>

    <table id="tablaFestivos" border="1" style="width:100%; border-collapse: collapse; margin-top: 20px;">
      <thead>
        <tr><th>Fecha</th><th>Descripci√≥n</th><th>Eliminar</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <div id="seccionTurnos" style="display:none; padding: 20px; background:#fff;">
      <h2>Turnos Generados</h2>
      <table id="tablaTurnos" border="1" style="width:100%; border-collapse: collapse;">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Tipo</th>
            <th>Notas</th>
          </tr>
        </thead>
        <tbody>
          <!-- Se llenar√° din√°micamente -->
        </tbody>
      </table>
    </div>
  </div>
  <footer>
    &copy; Made with <img width="20" height="20" src="https://img.icons8.com/metro/26/FA5252/hearts.png" alt="hearts"/> for TurnosApp 2025.
  </footer>

  <!-- --------------------------------JAVASCRIPT-------------------------- -->
  <script>
    const calendario = document.getElementById("calendario");
    const seccionCalendario = document.getElementById("seccionCalendario");
    const seccionFestivos = document.getElementById("seccionFestivos");
    const seccionTurnos = document.getElementById("seccionTurnos");
    const modal = document.getElementById("modalTurno");
    const cerrarModal = document.getElementById("cerrarModal");
    const formEditar = document.getElementById("formEditarTurno");
    const editFecha = document.getElementById("editFecha");
    const editHora = document.getElementById("editHora");
    const editTipo = document.getElementById("editTipo");
    const editNota = document.getElementById("editNota");
    const menu = document.getElementById("sideMenu");
    const tituloMes = document.getElementById("tituloMes");
    const btnPrev = document.getElementById("btnPrev");
    const btnNext = document.getElementById("btnNext");
    const tablaTurnos = document.getElementById("tablaTurnos").querySelector("tbody");
    const formFestivo = document.getElementById("formFestivo");
    const fechaFestivo = document.getElementById("fechaFestivo");
    const notaFestivo = document.getElementById("notaFestivo");

    let turnos = JSON.parse(localStorage.getItem("turnos")) || {};
    let fechaActual = new Date();

    function toggleMenu() {
      menu.classList.toggle("open");
    }

    function renderizarCalendario() {
      calendario.innerHTML = "";
      const anio = fechaActual.getFullYear();
      const mes = fechaActual.getMonth();
      const primerDia = new Date(anio, mes, 1);
      const ultimoDia = new Date(anio, mes + 1, 0);
      const offset = (primerDia.getDay() + 6) % 7;

      const nombreMeses = ["ENERO", "FEBRERO", "MARZO", "ABRIL", "MAYO", "JUNIO", "JULIO", "AGOSTO", "SEPTIEMBRE", "OCTUBRE", "NOVIEMBRE", "DICIEMBRE"];
      tituloMes.textContent = `${nombreMeses[mes]} ${anio}`;

      for (let i = 0; i < offset; i++) {
        const vacio = document.createElement("div");
        vacio.classList.add("dia");
        vacio.style.background = "#f4f4f4";
        calendario.appendChild(vacio);
      }

      for (let dia = 1; dia <= ultimoDia.getDate(); dia++) {
        const fecha = new Date(anio, mes, dia);
        const fechaLocal = new Date(fecha.getTime() - fecha.getTimezoneOffset() * 60000).toISOString().split("T")[0];
        const div = document.createElement("div");
        div.classList.add("dia");
        div.dataset.fecha = fechaLocal;
        div.innerHTML = `<strong>${dia}</strong><br>${renderizarTurno(fechaLocal)}`;
        div.onclick = () => abrirModal(fechaLocal);
        calendario.appendChild(div);
      }
    }

    function renderizarTurno(fecha) {
      const turno = turnos[fecha];
      return turno ? `${turno.tipo || ""}` : "";
    }

    function abrirModal(fecha) {
      controles.style.display = "none"; // üëà Oculta controles
      editFecha.value = fecha;
      const turno = turnos[fecha] || {};
      editHora.value = turno.hora || "";
      editTipo.value = turno.tipo || "M";
      editNota.value = turno.nota || "";
      modal.classList.remove("hidden");
    }

    cerrarModal.onclick = () =>{ modal.classList.add("hidden");
     // Muestra controles solo si estamos en calendario
  if (seccionCalendario.style.display !== "none") {
    controles.style.display = "flex";
  }
    };

    formEditar.onsubmit = function (e) {
      e.preventDefault();
      const fecha = editFecha.value;
      turnos[fecha] = {
        hora: editHora.value,
        tipo: editTipo.value,
        nota: editNota.value,
      };
      localStorage.setItem("turnos", JSON.stringify(turnos));
      modal.classList.add("hidden");
      renderizarCalendario();
    };

    btnPrev.onclick = () => {
      fechaActual.setMonth(fechaActual.getMonth() - 1);
      renderizarCalendario();
    };

    btnNext.onclick = () => {
      fechaActual.setMonth(fechaActual.getMonth() + 1);
      renderizarCalendario();
    };

    const controles = document.querySelector(".controls"); // Agrega esta l√≠nea arriba si no existe, para ocultar controles

    document.querySelectorAll("nav a").forEach(link => {
      link.addEventListener("click", e => {
        e.preventDefault();
        const section = link.dataset.section;
        menu.classList.remove("open");

        // Ocultar todas las secciones
        seccionFestivos.style.display = "none";
        seccionTurnos.style.display = "none";
        seccionCalendario.style.display = "none";
        controles.style.display = "none"; // Oculta controles por defecto no se ven turnos ni festivos

        if (section === "festivos") {
          seccionFestivos.style.display = "block";
          renderizarFestivos();
        } else if (section === "turnos") {
          seccionTurnos.style.display = "block";
          renderizarTurnos();
        } else if (section === "calendario") {
          seccionCalendario.style.display = "block";
          controles.style.display = "flex"; // Solo muestra en el calendario
        }
      });
    });

    function renderizarTurnos() {
      tablaTurnos.innerHTML = "";
      const fechas = Object.keys(turnos).sort();
      for (const fecha of fechas) {
        const t = turnos[fecha];
        const fila = document.createElement("tr");
        const [y, m, d] = fecha.split("-");
        const fechaFormateada = `${d}/${m}/${y}`;
        fila.innerHTML = `<td>${fechaFormateada}</td><td>${t.hora}</td><td>${t.tipo}</td><td>${t.nota}</td>`;

        tablaTurnos.appendChild(fila);
      }
    }

    function renderizarFestivos() {
  const tablaFestivos = document.getElementById("tablaFestivos").querySelector("tbody");
  tablaFestivos.innerHTML = "";
  const fechas = Object.keys(turnos).filter(f => turnos[f].tipo === "V").sort();

  for (const fecha of fechas) {
    const festivo = turnos[fecha];
    const [y, m, d] = fecha.split("-");
    const fechaFormateada = `${d}/${m}/${y}`;
    const fila = document.createElement("tr");
    fila.innerHTML = `
      <td>${fechaFormateada}</td>
      <td>${festivo.nota || "Festivo"}</td>
      <td><button onclick="eliminarFestivo('${fecha}')">üóëÔ∏è</button></td>
    `;
    tablaFestivos.appendChild(fila);
  }
}

    function eliminarFestivo(fecha) {
      if (confirm("¬øEliminar este festivo?")) {
        delete turnos[fecha];
        localStorage.setItem("turnos", JSON.stringify(turnos));
        renderizarFestivos();
        renderizarCalendario();
      }
    }

    formFestivo.onsubmit = function (e) {
      e.preventDefault();
      const fecha = fechaFestivo.value;
      turnos[fecha] = {
        tipo: "V",
        hora: "",
        nota: notaFestivo.value,
      };
      localStorage.setItem("turnos", JSON.stringify(turnos));
      renderizarFestivos();
      fechaFestivo.value = "";
      notaFestivo.value = "";
    };

    renderizarCalendario();
  </script>

  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("/misturno/service-worker.js")
          .then(reg => console.log("Service Worker registrado", reg))
          .catch(err => console.error("Error al registrar Service Worker", err));
      });
    }
  </script>
</body>
</html>




    
